<!DOCTYPE html>
<html>
    <head>
        <title>Disk Structure</title>
        <meta charset="utf-8">
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <style>
            h1 {
                text-align: center;
                font-size: 50px;
            }

            script {
                text-align: center;
            }
        </style>
    </head>
    <body>
        <h1>File Structure</h1>
        <input id="button1" type="button" value="Swipe Back (Navigate)" onclick="changeArc(false);"/>
        <input id="button2" type="button" value="Swipe Forwards (Navigate)" onclick="changeArc(true);"/>
        <input id="button3" type="button" value="Tap (Select)" onclick="selectSegment();"/>
        <input id="button4" type="button" value="Swipe Down (Back)" onclick="backSegment();"/>
        <script>
            "use strict";

            // Start of data population ---------------------------
            var allData = [];
            allData.name = "All Media Data";
            allData.type = true;
            allData.hasParent = false;
            allData.size = -1;

            var classWork = [];
            classWork.name = "Work Related Data";
            classWork.type = true;
            classWork.hasParent = true;
            classWork.parent = allData;
            classWork.size = -1;

            var classPlay = [];
            classPlay.name = "Non-Work Related Data";
            classPlay.type = true;
            classPlay.hasParent = true;
            classPlay.parent = allData;
            classPlay.size = -1;

            allData.push(classWork);
            allData.push(classPlay);

            var videoWork = [];
            videoWork.name = "Video Data";
            videoWork.type = true;
            videoWork.hasParent = true;
            videoWork.parent = classWork;
            videoWork.size = -1;

            var picWork = [];
            picWork.name = "Picture Data";
            picWork.type = true;
            picWork.hasParent = true;
            picWork.parent = classWork;
            picWork.size = -1;

            var docWork = [];
            docWork.name = "Document Data";
            docWork.type = true;
            docWork.hasParent = true;
            docWork.parent = classWork;
            docWork.size = -1;

            classWork.push(videoWork);
            classWork.push(picWork);
            classWork.push(docWork);

            var videoPlay = [];
            videoPlay.name = "Video Data";
            videoPlay.type = true;
            videoPlay.hasParent = true;
            videoPlay.parent = classPlay;
            videoPlay.size = -1;

            var picPlay = [];
            picPlay.name = "Picture Data";
            picPlay.type = true;
            picPlay.hasParent = true;
            picPlay.parent = classPlay;
            picPlay.size = -1;

            var docPlay = [];
            docPlay.name = "Document Data";
            docPlay.type = true;
            docPlay.hasParent = true;
            docPlay.parent = classPlay;
            docPlay.size = -1;

            classPlay.push(videoPlay);
            classPlay.push(picPlay);
            classPlay.push(docPlay);


            var numItems = 100;
            var totalSize = 0;

            // Size of media in bytes
            var minVideoSize = 10 * 1024;
            var maxVideoSize = 200 * 1024 * 1024;
            var minPictureSize = 1 * 1024;
            var maxPictureSize = 2 * 1024 * 1024;
            var minDocSize = 1 * 1024;
            var maxDocSize = 1 * 1024 * 1024;

            // Create scales
            var videoScale = d3.scale.linear()
                    .domain([0, 1])
                    .rangeRound([minVideoSize, maxVideoSize]);
            var picScale = d3.scale.linear()
                    .domain([0, 1])
                    .rangeRound([minPictureSize, maxPictureSize]);
            var docScale = d3.scale.linear()
                    .domain([0, 1])
                    .rangeRound([minDocSize, maxDocSize]);

            // Populate each array
            for (var i = 0; i < numItems; i++) {
                var categoryNum = Math.random() * 6;
                var itemName = "";
                var itemSize = -1;

                classWork.size = 0;
                classPlay.size = 0;

                videoWork.size = 0;
                picWork.size = 0;
                docWork.size = 0;
                videoPlay.size = 0;
                picPlay.size = 0;
                docPlay.size = 0;

                var item = new Object(),
                        parent = "",
                        hasParent = true,
                        type = false,
                        name = "",
                        size = -1;
                if (categoryNum < 1) {
                    itemName = "videoW" + i;
                    itemSize = videoScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = videoWork;
                    videoWork.size = videoWork.size + item.size;
                    classWork.size = classWork.size + item.size;
                    videoWork.push(item);
                }
                else if (categoryNum < 2) {
                    itemName = "picW" + i;
                    itemSize = picScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = picWork;
                    picWork.size = picWork.size + item.size;
                    classWork.size = classWork.size + item.size;
                    picWork.push(item);
                }
                else if (categoryNum < 3) {
                    itemName = "docW" + i;
                    itemSize = docScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = docWork;
                    docWork.size = docWork.size + item.size;
                    classWork.size = classWork.size + item.size;
                    docWork.push(item);
                }
                else if (categoryNum < 4) {
                    itemName = "videoP" + i;
                    itemSize = videoScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = videoPlay;
                    videoPlay.size = videoPlay.size + item.size;
                    classPlay.size = classPlay.size + item.size;
                    videoPlay.push(item);
                }
                else if (categoryNum < 5) {
                    itemName = "picP" + i;
                    itemSize = videoScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = picPlay;
                    picPlay.size = picPlay.size + item.size;
                    classPlay.size = classPlay.size + item.size;
                    picPlay.push(item);
                }
                else {
                    itemName = "docP" + i;
                    itemSize = docScale(Math.random());
                    item.name = itemName;
                    item.size = itemSize;
                    item.parent = docPlay;
                    docPlay.size = docPlay.size + item.size;
                    classPlay.size = classPlay.size + item.size;
                    docPlay.push(item);
                }
                totalSize = totalSize + itemSize;
            }
            // End of data population -----------------------------

            var svg = d3.select("body")
                    .append("svg")
                    .attr("width", 1300)
                    .attr("height", 300);

            var selectedData = allData;
            var highlightedIndex = 0;
            allData.size = totalSize;
            redraw();

            function changeArc(clockwise) {
                if (clockwise) {
                    highlightedIndex = highlightedIndex + 1;
                    if (highlightedIndex === selectedData.length) {
                        highlightedIndex = 0;
                    }
                } else {
                    highlightedIndex = highlightedIndex - 1;
                    if (highlightedIndex === -1) {
                        highlightedIndex = selectedData.length - 1;
                    }
                }
                redraw();
            }

            function selectSegment() {
                if (selectedData[highlightedIndex].type) {
                    selectedData = selectedData[highlightedIndex];
                    highlightedIndex = 0;
                    redraw();
                }
            }

            function backSegment() {
                console.log(selectedData.name);
                console.log(selectedData.hasParent);
                if (selectedData.hasParent) {
                    selectedData = selectedData.parent;
                    highlightedIndex = 0;
                    redraw();
                }
            }

            function redraw() {
                var degToRad = Math.PI / 180;
                var numSegments = selectedData.length;
                var segmentAngle = 360 / numSegments;

                d3.selectAll("svg > *")
                        .remove();

                for (var i = 0; i < numSegments; i++) {
                    var arc = d3.svg.arc()
                            .innerRadius(40)
                            .outerRadius(140)
                            .startAngle(i * segmentAngle * degToRad) //converting from degs to radians
                            .endAngle(((i + 1) * segmentAngle - 1) * degToRad) //just radians

                    var colour;
                    if (i === highlightedIndex) {
                        colour = "red";
                    } else {
                        colour = "blue";
                    }
                    svg.append("path")
                            .attr("d", arc)
                            .attr("fill", colour)
                            .attr("transform", "translate(600, 140)");
                }

                svg.append("text")
                        .text("Browsing: " + selectedData.name)
                        .attr("x", 750)
                        .attr("y", 100);

                svg.append("text")
                        .text("Total size: " + selectedData.size + " bytes")
                        .attr("x", 750)
                        .attr("y", 120);


                svg.append("text")
                        .text("Selected: " + selectedData[highlightedIndex].name)
                        .attr("x", 750)
                        .attr("y", 150);

                svg.append("text")
                        .text("Size: " + selectedData[highlightedIndex].size + " bytes")
                        .attr("x", 750)
                        .attr("y", 170);
            }

        </script>
    </body>
</html>
